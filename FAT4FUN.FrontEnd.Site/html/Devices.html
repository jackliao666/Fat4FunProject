<!DOCTYPE html>
<html lang="zh-tw">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fat4Fun-PC</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="NavFooter.css" />
    <!-- <script src="/shared-components.js"></script> -->
    <script src="/vue.global.js"></script>

    <style>
      .accordion-menu {
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        background-color: #f8f9fa;
        padding: 1rem;
        margin-top: 150px;
        border-right: 1px solid #ddd;
        overflow-y: auto;
      }
      .accordion-item {
        border: none;
      }
      .accordion-button {
        background-color: #343a40;
        color: white;
      }
      .accordion-button:not(.collapsed) {
        background-color: #495057;
        color: white;
      }
      .accordion-button:focus {
        box-shadow: none;
      }
      .accordion-body ul {
        padding-left: 1rem;
      }
      .accordion-body ul li {
        list-style: none;
      }
      .accordion-body ul li a {
        text-decoration: none;
        color: #495057;
        cursor: pointer;
      }
      .accordion-body ul li a:hover {
        color: #007bff;
      }
      .content {
        margin-top: 150px;
        margin-left: 260px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        min-height: 80vh;
      }
      .card-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        padding: 1.5rem;
      }
      .card {
        display: flex;
        flex-direction: column;
        height: 100%;
        border: none;
        border-radius: 8px;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }
      .card-img-top {
        height: 200px;
        object-fit: cover;
      }
      .card-body {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        padding: 1rem;
      }
      .card-title {
        font-size: 1rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      .card-text {
        font-size: 0.9rem;
        color: #6c757d;
        flex-grow: 1;
      }
      .card-brand,
      .card-price {
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
      }
      .card-brand {
        color: #007bff;
      }
      .card-price {
        font-weight: bold;
        color: #28a745;
      }
      .btn-add-to-cart {
        width: 100%;
        margin-top: 0.5rem;
      }
      .pagination {
        margin-top: auto;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <header-component></header-component>

      <div class="accordion accordion-menu" id="accordionExample">
        <div
          class="accordion-item"
          v-for="(item, index) in series"
          :key="index"
        >
          <h2 class="accordion-header" :id="'heading' + index">
            <button
              class="accordion-button"
              type="button"
              data-bs-toggle="collapse"
              :data-bs-target="'#collapse' + index"
              aria-expanded="false"
              :aria-controls="'collapse' + index"
              @click="selectedAccordion = index"
              :class="{'active-accordion': selectedAccordion === index}"
            >
              {{ item.name }}
            </button>
          </h2>
          <div
            :id="'collapse' + index"
            class="accordion-collapse collapse"
            data-bs-parent="#accordionExample"
          >
            <div class="accordion-body">
              <ul>
                <li v-for="sub in item.subcategories" :key="sub.name">
                  <a href="#" @click="filterBySubcategory(sub.name)"
                    >{{ sub.name }}</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="row mb-3">
          <div class="col-md-2">
            <input
              id="minPrice"
              type="number"
              class="form-control"
              v-model.number="minPrice"
              placeholder="最低價格"
              @input="filterProducts"
            />
          </div>
          <div class="col-md-2">
            <input
              id="maxPrice"
              type="number"
              class="form-control"
              v-model.number="maxPrice"
              placeholder="最高價格"
              @input="filterProducts"
            />
          </div>
          <div class="col-md-2">
            <select
              id="priceSort"
              class="form-select"
              v-model="selectedPriceSort"
              @change="filterProducts"
            >
              <option value="">默認排序</option>
              <option value="asc">價格：低到高</option>
              <option value="desc">價格：高到低</option>
            </select>
          </div>
          <div class="col-md-2">
            <select
              id="brandSelect"
              class="form-select"
              v-model="selectedBrand"
              @change="filterProducts"
            >
              <option value="">所有品牌</option>
              <option value="ASUS">ASUS-華碩</option>
              <option value="MSI">MSI-微星</option>
              <option value="ACER">ACER-宏碁</option>
              <option value="GIGABYTE">GIGABYTE-技嘉</option>
            </select>
          </div>
          <div class="col-md-2">
            <select
              id="categorySelect"
              class="form-select"
              v-model="selectedCategory"
              @change="updateSubOptions"
            >
              <option value="">選擇類別</option>
              <option value="harddrive">硬碟</option>
              <option value="memory">記憶體</option>
              <option value="gpu">顯示卡</option>
            </select>
          </div>
          <div class="col-md-2">
            <select
              id="subCategorySelect"
              class="form-select"
              v-model="selectedSubCategory"
              @change="filterProducts"
            >
              <option value="">請先選擇類別</option>
              <option
                v-for="option in subOptions"
                :key="option"
                :value="option"
              >
                {{ option }}
              </option>
            </select>
          </div>
        </div>

        <div class="card-container" style="flex-grow: 1">
          <div
            class="card"
            v-for="product in paginatedProducts"
            :key="product.id"
            @click="goToPcDetail(product.id)"
          >
            <img
              :src="product.image"
              class="card-img-top"
              :alt="product.name"
            />
            <div class="card-body">
              <h5 class="card-title">{{ product.name }}</h5>
              <p class="card-text">{{ product.description }}</p>
              <p class="card-brand">品牌: {{ product.brand }}</p>

              <!-- 使用规格中的第一个价格 -->
              <p class="card-price">價格: ${{ product.specs[0].price }}</p>

              <!-- 顯示默認規格 -->
              <p class="card-specs">
                規格: {{ product.specs[0].harddrive }} / {{
                product.specs[0].memory }} / {{ product.specs[0].gpu }}
              </p>

              <button
                class="btn btn-primary btn-add-to-cart"
                @click.stop="addToCart(product)"
              >
                加入購物車
              </button>
            </div>
          </div>
        </div>

        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            <li class="page-item" :class="{ disabled: currentPage === 1 }">
              <a
                class="page-link"
                href="#"
                @click.prevent="setCurrentPage(currentPage - 1)"
                >Previous</a
              >
            </li>
            <li
              class="page-item"
              v-for="page in totalPages"
              :key="page"
              :class="{ active: currentPage === page }"
            >
              <a
                class="page-link"
                href="#"
                @click.prevent="setCurrentPage(page)"
                >{{ page }}</a
              >
            </li>
            <li
              class="page-item"
              :class="{ disabled: currentPage === totalPages }"
            >
              <a
                class="page-link"
                href="#"
                @click.prevent="setCurrentPage(currentPage + 1)"
                >Next</a
              >
            </li>
          </ul>
        </nav>
      </div>
      <footer-component></footer-component>
    </div>
  </body>
  <script type="module">
    import { HeaderComponent, FooterComponent } from "./shared-components.js";
    const app = Vue.createApp({
      data() {
        return {
          selectedSubcategory: "",
          selectedBrand: "",
          selectedPriceSort: "",
          minPrice: null,
          maxPrice: null,
          selectedCategory: "",
          selectedSubCategory: "",
          subOptions: [],
          series: [], // 分类系列数据
          products: [], // 全部商品数据
          filteredProducts: [], // 已过滤的商品数据
          currentPage: 1, // 当前页码
          itemsPerPage: 10, // 每页显示商品数量
        };
      },
      mounted() {
        // 加载商品数据
        fetch("products.json")
          .then((response) => response.json())
          .then((data) => {
            this.products = data;
            this.filteredProducts = data; // 初始化显示所有商品
            localStorage.setItem("products", JSON.stringify(this.products));
          })
          .catch((error) => console.error("Error loading products:", error));

        // 加载系列数据
        fetch("DeviceBrand.json")
          .then((response) => response.json())
          .then((data) => {
            this.series = data;
          })
          .catch((error) => console.error("Error loading series:", error));
      },
      computed: {
        // 返回当前页显示的商品
        paginatedProducts() {
          const start = (this.currentPage - 1) * this.itemsPerPage;
          const end = start + this.itemsPerPage;
          return this.filteredProducts.slice(start, end);
        },
        // 计算总页数
        totalPages() {
          return Math.ceil(this.filteredProducts.length / this.itemsPerPage);
        },
      },
      methods: {
        // 根据选择的子分类进行过滤
        filterBySubcategory(subcategory) {
          this.selectedSubcategory = subcategory;
          this.filterProducts();
        },

        // 根据所选类别更新子类别选项
        updateSubOptions() {
          if (this.selectedCategory === "harddrive") {
            this.subOptions = ["1TB", "2TB", "4TB"];
          } else if (this.selectedCategory === "memory") {
            this.subOptions = ["8G", "16G", "32G"];
          } else if (this.selectedCategory === "gpu") {
            this.subOptions = ["RTX3060", "RTX4060", "RTX4070", "RTX4080"];
          } else {
            this.subOptions = [];
          }
          this.selectedSubCategory = ""; // 重置已选择的子类别
          this.filterProducts(); // 调用过滤函数重新筛选商品
        },

        // 根据子类别、品牌、价格区间和其他条件过滤商品
        filterProducts() {
          let products = this.products.filter((product) => {
            const matchesSubcategory = this.selectedSubcategory
              ? product.category === this.selectedSubcategory
              : true;
            const matchesBrand = this.selectedBrand
              ? product.brand === this.selectedBrand
              : true;

            // 过滤每个商品的 specs 数组
            const matchesSpecs = product.specs.some((spec) => {
              const matchesMinPrice =
                this.minPrice !== null ? spec.price >= this.minPrice : true;
              const matchesMaxPrice =
                this.maxPrice !== null ? spec.price <= this.maxPrice : true;

              // 根据选中的子类别进行匹配
              let matchesSubCategory = true;
              if (this.selectedCategory && this.selectedSubCategory) {
                const categoryKey = this.selectedCategory;
                matchesSubCategory =
                  spec[categoryKey] === this.selectedSubCategory;
              }

              return matchesMinPrice && matchesMaxPrice && matchesSubCategory;
            });

            return matchesSubcategory && matchesBrand && matchesSpecs;
          });

          // 根据价格排序
          if (this.selectedPriceSort === "asc") {
            products.sort((a, b) => a.specs[0].price - b.specs[0].price);
          } else if (this.selectedPriceSort === "desc") {
            products.sort((a, b) => b.specs[0].price - a.specs[0].price);
          }

          this.filteredProducts = products; // 更新过滤后的商品列表
        },

        // 切换分页页码
        setCurrentPage(page) {
          if (page >= 1 && page <= this.totalPages) {
            this.currentPage = page;
          }
        },

        // 跳转到商品详情页
        goToPcDetail(productId) {
          window.location.href = `PcDetail.html?id=${productId}`;
        },
      },
    });

    app.component("header-component", HeaderComponent);
    app.component("footer-component", FooterComponent);

    app.mount("#app");
  </script>
</html>
