<!DOCTYPE html>
<html lang="zh-TW" style="background-color: #f0f2f5">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fat4Fun-確認商品及填寫資料</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="../Content/NavFooter.css" />
    <script src="../Scripts/vue.global.js"></script>
    <style>
      .stepper {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .step {
        text-align: center;
        width: 100%;
        position: relative;
      }

      .step:not(:last-child)::after {
        content: "";
        position: absolute;
        top: 50%;
        right: -50%;
        width: 100%;
        height: 2px;
        background-color: #e0e0e0;
        z-index: 1;
      }

      .step.active .circle {
        background-color: #c6a272;
        color: white;
      }

      .circle {
        display: inline-block;
        width: 40px;
        height: 40px;
        line-height: 40px;
        border-radius: 50%;
        background-color: #e0e0e0;
        z-index: 2;
      }

      .label {
        margin-top: 10px;
        font-size: 14px;
        color: #7d7d7d;
      }

      .step.active .label {
        color: #000;
      }
      .table th,
      .table td {
        width: 25%; /* 根據需要調整 */
      }
      .table .text-end {
        text-align: right;
      }
      h4 {
        color: #222;
      }
      .btn-primary {
        background-color: #007bff; /* 按鈕主色 */
        border-color: #007bff; /* 按鈕邊框顏色 */
      }
      .btn-primary:hover {
        background-color: #0056b3;
        border-color: #004085;
      }
    </style>
  </head>

  <body style="background-color: #f0f2f5">
    <div id="app">
      <!-- nav start-->
      <header-component @search="handleSearch"></header-component>
      <!-- nav end -->
      <!-- 購物流程Start -->
      <div class="container" style="margin-top: 180px">
        <div class="stepper">
          <!-- 第一步 -->
          <div class="step active">
            <div class="circle">1</div>
            <div class="label">購物車及填寫資料</div>
          </div>

          <!-- 第二步 -->
          <div class="step">
            <div class="circle">2</div>
            <div class="label">確認資料</div>
          </div>

          <!-- 第三步 -->
          <div class="step">
            <div class="circle">3</div>
            <div class="label">訂購完成</div>
          </div>
        </div>
      </div>
      <!-- 購物流程End -->
      <!-- 確認商品列表 -->
      <div class="container mt-5" style="color: #333">
        <div>
          <h4>確認商品</h4>
          <table class="table table-bordered mt-3">
            <thead>
              <tr>
                <th class="text-center">商品</th>
                <th class="text-center">數量</th>
                <th class="text-center">單價</th>
                <th class="text-center">總價</th>
                <th class="text-center"></th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="item in cartItems" :key="item.id">
                <td>{{ item.name }}</td>
                <td class="text-center">
                  <!-- 減少按鈕 -->
                  <button
                    @click="decreaseQuantity(item)"
                    class="btn btn-sm btn-primary"
                  >
                    -
                  </button>
                  <span class="mx-2"></span>
                  {{ item.quantity }}
                  <!-- 增加按鈕 -->
                  <span class="mx-2"></span>
                  <button
                    @click="increaseQuantity(item)"
                    class="btn btn-sm btn-primary"
                  >
                    +
                  </button>
                </td>
                <!-- 格式化單價和總價 -->
                <td class="text-end">{{ formatCurrency(item.price) }} 元</td>
                <td class="text-end">
                  {{ formatCurrency(item.quantity * item.price) }} 元
                </td>
                <td class="text-center">
                  <!-- 刪除按鈕 -->
                  <button
                    @click="removeItem(item)"
                    class="btn btn-sm btn-danger"
                  >
                    X
                  </button>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="3" class="text-end">總計：</td>
                <!-- 格式化總計 -->
                <td class="text-end">{{ formatCurrency(total) }} 元</td>
                <td class="text-center"></td>
              </tr>
            </tfoot>
          </table>
        </div>

        <!-- 取貨方式 -->
        <div class="mt-4 mb-3">
          <div class="">
            <h4>取貨方式</h4>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                v-model="deliveryMethod"
                value="宅配"
                id="delivery1"
              />
              <label class="form-check-label" for="delivery1">宅配</label>
            </div>
          </div>
        </div>

        <!-- 客戶資料 -->
        <div class="mt-3 mb-3">
          <h4>收件人資料</h4>
          <div class="mb-3">
            <label for="name" class="form-label">姓名</label>
            <input
              type="text"
              class="form-control"
              id="name"
              v-model="customer.name"
              placeholder="輸入姓名"
            />
          </div>
          <div class="mb-3">
            <label for="phone" class="form-label">電話</label>
            <input
              type="text"
              class="form-control"
              id="phone"
              v-model="customer.phone"
              placeholder="輸入電話"
            />
          </div>
          <div class="mb-3">
            <label for="Adress" class="form-label">送貨地址</label>
            <input
              type="text"
              class="form-control"
              id="Adress"
              v-model="customer.adress"
              placeholder="送貨地址"
            />
          </div>
        </div>
        <!-- 付款方式 -->
        <div class="mt-4 mb-3">
          <h4>付款方式</h4>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              v-model="paymentMethod"
              value="貨到付款"
              id="payment1"
            />
            <label class="form-check-label" for="payment1">貨到付款</label>
          </div>
        </div>

        <!-- 發票選項 -->
        <div class="mt-4 mb-3">
          <h4>發票選項</h4>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              v-model="invoiceMethod"
              value="電子發票"
              id="invoice1"
            />
            <label class="form-check-label" for="invoice1">電子發票</label>
          </div>
        </div>

        <!-- 確認按鈕 -->
        <div class="mt-4 mb-5">
          <button @click="submitOrder" class="btn btn-primary w-100">
            確認結帳
          </button>
        </div>
      </div>

      <!-- footer start-->
      <footer-component></footer-component>
      <!-- footer end -->
    </div>
    <!-- 導覽列元件 -->
    <script type="module">
        import { HeaderComponent, FooterComponent } from "../Scripts/shared-components.js";
      const app = Vue.createApp({
        // 定義你的其他數據和方法
        data() {
          return {
            cartItems: JSON.parse(localStorage.getItem("cart")) || [],
            deliveryMethod: "宅配",
            customer: {
              name: "",
              phone: "",
              adress: "",
            },
            paymentMethod: "貨到付款",
            invoiceMethod: "電子發票",
          };
        },
        computed: {
          total() {
            return this.cartItems.reduce(
              (acc, item) => acc + item.quantity * item.price,
              0
            );
          },
        },
        created() {
          const savedCustomer = localStorage.getItem("customerInfo");
          if (savedCustomer) {
            this.customer = JSON.parse(savedCustomer);
          }
        },
        methods: {
            increaseQuantity(item) {
                item.quantity++;
                localStorage.setItem("cart", JSON.stringify(this.cartItems));
            },
          decreaseQuantity(item) {
            if (item.quantity > 1) {
              item.quantity--;
            } else {
              const index = this.cartItems.indexOf(item);
              if (index > -1) {
                this.cartItems.splice(index, 1);
              }
            }
            localStorage.setItem("cart", JSON.stringify(this.cartItems));
          },
          formatCurrency(value) {
              if (typeof value !== 'number' || isNaN(value)) {
                  return '0';
              }
              return value.toLocaleString();
          },
          submitOrder() {
            if (this.cartItems.length === 0) {
              alert("購物車內無商品繼續選購！");
              return;
            }
            if (
              this.customer.name &&
              this.customer.phone &&
              this.customer.adress
            ) {
              localStorage.setItem(
                "customerInfo",
                JSON.stringify(this.customer)
              );
              localStorage.setItem("cart", JSON.stringify(this.cartItems));

              window.location.href = "Checkout-Confirmation.html";
            } else {
              alert("請填寫完整的顧客資料！");
            }
          },
          removeItem(item) {
            this.cartItems = this.cartItems.filter(
              (cartItem) => cartItem.id !== item.id
            );
            localStorage.setItem("cart", JSON.stringify(this.cartItems));
          },
        },
      });

        app.component("header-component", HeaderComponent);
        app.component("footer-component", FooterComponent);

        app.mount("#app");
    </script>
  </body>
</html>
